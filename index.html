<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gestão Financeira Pessoal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
    <meta name="theme-color" content="#3b5b70">
    <!-- Chart.js via CDN -->
     <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
     <!-- Supabase env and client (safe-load) -->
     <script src="assets/js/env.local.js"></script>
  <script src="assets/js/env.js"></script>
     <script type="module" src="assets/js/core/supabaseClient.js"></script>
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="logo">FinançasPro</div>
        <nav class="nav">
          <a href="#/dashboard" data-route="dashboard" class="nav-link active">Dashboard</a>
          <a href="#/transactions" data-route="transactions" class="nav-link">Transações</a>
          <a href="#/categories" data-route="categories" class="nav-link">Categorias</a>
          <a href="#/banks" data-route="banks" class="nav-link">Bancos</a>
          <a href="#/goals" data-route="goals" class="nav-link">Metas</a>
        </nav>
      </aside>

      <div class="content">
        <header class="header">
          <div class="header-left">
            <div class="header-controls">
              <button id="btn-menu" class="btn-menu" aria-label="Menu">☰</button>
            </div>
            <div class="header-title">
              <h1 id="page-title">Dashboard</h1>
            </div>
          </div>

          <div class="header-right">
            <div id="user-info" class="user-info" hidden>
              <span id="user-greeting">Olá, <strong id="user-name"></strong></span>
              <button id="btn-logout" class="btn btn-secondary small">Sair</button>
            </div>
            <div id="guest-info" class="user-info" hidden>
              <span>Você não está logado</span>
            </div>
          </div>
        </header>

        <main class="page-container">
          <section id="page-auth" class="page hidden">
            <div class="auth-wrapper">
              <div class="auth-hero">
                <div class="auth-hero-inner">
                  <div class="brand">FinançasPro</div>
                  <div class="subtitle">Organize suas finanças com clareza e praticidade.</div>
                </div>
              </div>
              <div class="auth-panel">
                <div class="auth-card">
                  <div class="card auth-ui">
                    <div class="auth-card-header">
                      <div class="auth-lock-circle" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                          <rect x="5" y="11" width="14" height="10" rx="2"></rect>
                          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                      </div>
                      <h2 class="card-title">Bem-vindo</h2>
                      <p class="card-desc">Entre na sua conta ou crie uma nova para continuar</p>
                    </div>

                    <div class="auth-tabs">
                      <div class="tabs-list">
                        <button type="button" class="tabs-trigger active" data-tab="login" aria-controls="form-login">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M10 17l5-5-5-5"></path>
                            <path d="M4 12h11"></path>
                          </svg>
                          Entrar
                        </button>
                        <button type="button" class="tabs-trigger" data-tab="register" aria-controls="form-register">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="8" r="4"></circle>
                            <path d="M6 20a6 6 0 0 1 12 0"></path>
                            <path d="M19 8h4"></path>
                            <path d="M21 6v4"></path>
                          </svg>
                          Cadastrar
                        </button>
                      </div>

                      <div class="tabs-content" data-tab="login">
                        <form id="form-login" class="form-grid small">
                          <div class="form-group">
                            <label for="login-email">Email</label>
                            <div class="input-with-icon">
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <rect x="3" y="5" width="18" height="14" rx="2"></rect>
                                <path d="M3 7l9 6 9-6"></path>
                              </svg>
                              <input id="login-email" name="email" type="email" required class="with-icon" />
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="login-password">Senha</label>
                            <div class="input-with-icon">
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <rect x="5" y="11" width="14" height="10" rx="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                              </svg>
                              <input id="login-password" name="password" type="password" required class="with-icon" />
                            </div>
                          </div>
                          <div class="form-group form-actions">
                            <button type="submit" class="btn btn-primary">Entrar</button>
                            <button type="button" id="auth-toggle-register" class="btn btn-link">Criar conta</button>
                          </div>

                        </form>
                      </div>

                      <div class="tabs-content" data-tab="register" hidden>
                        <form id="form-register" class="form-grid small">
                          <div class="form-group">
                            <label for="reg-name">Nome</label>
                            <div class="input-with-icon">
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <circle cx="12" cy="8" r="4"></circle>
                                <path d="M6 20a6 6 0 0 1 12 0"></path>
                              </svg>
                              <input id="reg-name" name="name" type="text" required class="with-icon" />
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="reg-email">Email</label>
                            <div class="input-with-icon">
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <rect x="3" y="5" width="18" height="14" rx="2"></rect>
                                <path d="M3 7l9 6 9-6"></path>
                              </svg>
                              <input id="reg-email" name="email" type="email" required class="with-icon" />
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="reg-password">Senha</label>
                            <div class="input-with-icon">
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <rect x="5" y="11" width="14" height="10" rx="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                              </svg>
                              <input id="reg-password" name="password" type="password" required class="with-icon" />
                            </div>
                          </div>
                          <div class="form-group form-actions">
                            <button type="submit" class="btn btn-primary">Cadastrar</button>
                            <button type="button" id="auth-toggle-login" class="btn btn-link">Já tenho conta</button>
                          </div>
                        </form>
                      </div>
                    </div>

                    <div id="auth-message" class="form-message" aria-live="polite"></div>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <!-- Dashboard -->
          <section id="page-dashboard" class="page">
            <div class="card">
              <h2 class="card-title">Meta Mensal de Gastos</h2>
              <div class="progress">
                <div class="progress-bar">
                  <div id="progress-fill" class="progress-fill" style="width:0%"></div>
                </div>
                <div class="progress-text">
                  <span id="progress-spent">Gasto: R$ 0,00</span>
                  <span id="progress-goal">Meta: R$ 0,00</span>
                </div>
                <div class="progress-text">
                  <span id="progress-percent">Progresso: 0%</span>
                  <span id="progress-warning" class="warning" hidden></span>
                </div>
              </div>
            </div>

            <div class="dashboard-grid-charts">
              <div class="card">
                <h2 class="card-title">Despesas por Categoria</h2>
                <div class="chart-square">
                  <canvas id="pie-expenses-by-category"></canvas>
                </div>
                <div id="pie-info" class="chart-info"></div>
              </div>
              <div class="card">
                <h2 class="card-title">Despesas por Banco</h2>
                <div class="chart-square">
                  <canvas id="pie-expenses-by-bank"></canvas>
                </div>
                <div id="pie-info-banks" class="chart-info"></div>
              </div>
            </div>
          </section>

          <!-- Transações -->
          <section id="page-transactions" class="page hidden">
            <div class="card">
              <h2 class="card-title">Nova Transação</h2>
              <form id="form-transaction" class="form-grid">
                <div class="form-group">
                  <label for="tx-description">Descrição</label>
                  <input id="tx-description" name="description" type="text" required />
                </div>
                <div class="form-group">
                  <label for="tx-amount">Valor (R$)</label>
                  <input id="tx-amount" name="amount" type="number" min="0.01" step="0.01" required />
                </div>
                <div class="form-group">
                  <label for="tx-date">Data</label>
                  <input id="tx-date" name="date" type="date" required />
                </div>
                <div class="form-group">
                  <label for="tx-type">Tipo</label>
                  <select id="tx-type" name="type" required>
                    <option value="expense">Despesa</option>
                    <option value="income">Receita</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="tx-category">Categoria</label>
                  <select id="tx-category" name="categoryId" required></select>
                </div>
                <div class="form-group" id="tx-bank-group">
                  <label for="tx-bank">Banco</label>
                  <select id="tx-bank" name="bankId"></select>
                </div>
                <div class="form-group form-actions">
                  <button type="submit" class="btn btn-primary">Adicionar</button>
                </div>
              </form>
            </div>

            <div class="card">
              <h2 class="card-title">Transações do Mês Atual</h2>
              <table class="table">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Banco</th>
                    <th>Valor</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="table-transactions"></tbody>
              </table>
            </div>
          </section>

          <!-- Categorias -->
          <section id="page-categories" class="page hidden">
            <div class="card">
              <h2 class="card-title">Nova Categoria</h2>
              <form id="form-category" class="form-grid small">
                <div class="form-group">
                  <label for="cat-name">Nome</label>
                  <input id="cat-name" name="name" type="text" required />
                </div>
                <div class="form-group">
                  <label for="cat-color">Cor</label>
                  <input id="cat-color" name="color" type="color" value="#6200ee" required />
                </div>
                <div class="form-group form-actions">
                  <button type="submit" class="btn btn-primary">Adicionar</button>
                </div>
              </form>
            </div>

            <div class="card">
              <h2 class="card-title">Categorias</h2>
              <div id="grid-categories" class="grid-categories"></div>
            </div>
          </section>

          <!-- Metas -->
          <section id="page-goals" class="page hidden">
            <div class="card">
              <h2 class="card-title">Meta Mensal de Gastos</h2>
              <form id="form-monthly-goal" class="form-grid small">
                <div class="form-group">
                  <label for="goal-amount">Valor da Meta (R$)</label>
                  <input id="goal-amount" name="amount" type="number" min="0.01" step="0.01" required />
                </div>
                <div class="form-group form-actions">
                  <button type="submit" class="btn btn-primary">Atualizar</button>
                </div>
              </form>
            </div>

            <div class="card">
              <h2 class="card-title">Meta por Categoria</h2>
              <form id="form-category-goal" class="form-grid">
                <div class="form-group">
                  <label for="goal-category">Categoria</label>
                  <select id="goal-category" name="categoryId" required></select>
                </div>
                <div class="form-group">
                  <label for="goal-cat-amount">Valor da Meta (R$)</label>
                  <input id="goal-cat-amount" name="amount" type="number" min="0.01" step="0.01" required />
                </div>
                <div class="form-group form-actions">
                  <button type="submit" class="btn btn-primary">Adicionar</button>
                </div>
              </form>

              <div id="list-category-goals" class="grid-category-goals"></div>
            </div>
          </section>
          <!-- Bancos -->
          <section id="page-banks" class="page hidden">
            <div class="card">
              <h2 class="card-title">Novo Banco</h2>
              <form id="form-bank" class="form-grid small">
                <div class="form-group">
                  <label for="bank-name">Nome</label>
                  <input id="bank-name" name="name" type="text" required />
                </div>
                <div class="form-group form-actions">
                  <button type="submit" class="btn btn-primary">Adicionar</button>
                </div>
              </form>
            </div>

            <div class="card">
              <h2 class="card-title">Bancos</h2>
              <div id="grid-banks" class="grid-categories"></div>
            </div>
          </section>

        </main>
      </div>
    </div>

    <!-- FAB (Ações rápidas) -->
    <div class="fab-container" aria-label="Ações rápidas">
      <button class="fab-main" aria-label="Abrir ações">+</button>

    </div>

    <div id="drawer-overlay" class="drawer-overlay"></div>
    <script type="module" src="assets/js/services/authService.js"></script>
    <script type="module" src="assets/js/services/bootstrapServices.js"></script>
    <script src="assets/js/app.js"></script>
    <script type="module" src="assets/js/main.js"></script>
    <script src="assets/js/services/goalsService.js"></script>
     <script>
      // Registro do Service Worker sem interferir na lógica existente
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js').catch(() => {});
        });
      }
    </script>
  </body>
</html>